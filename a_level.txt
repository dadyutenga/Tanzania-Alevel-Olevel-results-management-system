-- tz_alevel_combinations: Stores A-level combinations (e.g., PCM, CBG)
CREATE TABLE `tz_alevel_combinations` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `combination_code` varchar(10) NOT NULL COMMENT 'e.g., PCM, CBG',
  `combination_name` varchar(100) NOT NULL COMMENT 'e.g., Physics-Chemistry-Math',
  `is_active` enum('yes', 'no') DEFAULT 'yes' COMMENT 'yes = active, no = inactive',
  `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
  `updated_at` timestamp NULL DEFAULT NULL ON UPDATE current_timestamp(),
  PRIMARY KEY (`id`),
  UNIQUE KEY `combination_code` (`combination_code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;

-- tz_alevel_combination_subjects: Links combinations to subjects
CREATE TABLE `tz_alevel_combination_subjects` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `combination_id` int(11) NOT NULL COMMENT 'References tz_alevel_combinations',
  `subject_name` varchar(100) NOT NULL COMMENT 'e.g., Physics, General Studies',
  `subject_type` enum('major', 'additional') NOT NULL COMMENT 'major = core subject, additional = GS or extra',
  `is_active` enum('yes', 'no') DEFAULT 'yes',
  `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
  `updated_at` timestamp NULL DEFAULT NULL ON UPDATE current_timestamp(),
  PRIMARY KEY (`id`),
  KEY `combination_id` (`combination_id`),
  CONSTRAINT `tz_alevel_combination_subjects_ibfk_1` FOREIGN KEY (`combination_id`) REFERENCES `tz_alevel_combinations` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;

-- tz_student_alevel_combinations: Assigns combinations to a class, section, and session
CREATE TABLE `tz_student_alevel_combinations` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `combination_id` int(11) NOT NULL COMMENT 'References tz_alevel_combinations',
  `class_id` int(11) NOT NULL COMMENT 'References classes table, e.g., Form 5 or 6',
  `section_id` int(11) DEFAULT NULL COMMENT 'References sections table, optional',
  `session_id` int(11) NOT NULL COMMENT 'References sessions table',
  `is_active` enum('yes', 'no') DEFAULT 'yes',
  `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
  `updated_at` timestamp NULL DEFAULT NULL ON UPDATE current_timestamp(),
  PRIMARY KEY (`id`),
  KEY `combination_id` (`combination_id`),
  KEY `class_id` (`class_id`),
  KEY `section_id` (`section_id`),
  KEY `session_id` (`session_id`),
  CONSTRAINT `tz_student_alevel_combinations_ibfk_1` FOREIGN KEY (`combination_id`) REFERENCES `tz_alevel_combinations` (`id`) ON DELETE CASCADE,
  CONSTRAINT `tz_student_alevel_combinations_ibfk_2` FOREIGN KEY (`class_id`) REFERENCES `classes` (`id`) ON DELETE CASCADE,
  CONSTRAINT `tz_student_alevel_combinations_ibfk_3` FOREIGN KEY (`section_id`) REFERENCES `sections` (`id`) ON DELETE SET NULL,
  CONSTRAINT `tz_student_alevel_combinations_ibfk_4` FOREIGN KEY (`session_id`) REFERENCES `sessions` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;

-- tz_alevel_exam_combinations: Links exams to combinations to prevent mix-ups
CREATE TABLE `tz_alevel_exam_combinations` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `exam_id` int(11) NOT NULL COMMENT 'References tz_exams table',
  `combination_id` int(11) NOT NULL COMMENT 'References tz_alevel_combinations',
  `class_id` int(11) NOT NULL COMMENT 'References classes table, e.g., Form 5 or 6',
  `session_id` int(11) NOT NULL COMMENT 'References sessions table',
  `is_active` enum('yes', 'no') DEFAULT 'yes',
  `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
  `updated_at` timestamp NULL DEFAULT NULL ON UPDATE current_timestamp(),
  PRIMARY KEY (`id`),
  KEY `exam_id` (`exam_id`),
  KEY `combination_id` (`combination_id`),
  KEY `class_id` (`class_id`),
  KEY `session_id` (`session_id`),
  CONSTRAINT `tz_alevel_exam_combinations_ibfk_1` FOREIGN KEY (`exam_id`) REFERENCES `tz_exams` (`id`) ON DELETE CASCADE,
  CONSTRAINT `tz_alevel_exam_combinations_ibfk_2` FOREIGN KEY (`combination_id`) REFERENCES `tz_alevel_combinations` (`id`) ON DELETE CASCADE,
  CONSTRAINT `tz_alevel_exam_combinations_ibfk_3` FOREIGN KEY (`class_id`) REFERENCES `classes` (`id`) ON DELETE CASCADE,
  CONSTRAINT `tz_alevel_exam_combinations_ibfk_4` FOREIGN KEY (`session_id`) REFERENCES `sessions` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;

-- tz_alevel_exam_results: Stores A-level-specific results
CREATE TABLE `tz_alevel_exam_results` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `student_id` int(11) NOT NULL,
  `exam_id` int(11) NOT NULL,
  `class_id` int(11) NOT NULL,
  `session_id` int(11) NOT NULL,
  `combination_id` int(11) NOT NULL COMMENT 'References tz_alevel_combinations',
  `total_points` int(11) DEFAULT NULL COMMENT 'Sum of points from major subjects',
  `division` varchar(5) DEFAULT NULL COMMENT 'A-level division, e.g., I, II, III',
  `division_description` varchar(50) DEFAULT NULL COMMENT 'e.g., Excellent, Good',
  `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
  `updated_at` timestamp NULL DEFAULT NULL ON UPDATE current_timestamp(),
  PRIMARY KEY (`id`),
  KEY `student_id` (`student_id`),
  KEY `exam_id` (`exam_id`),
  KEY `class_id` (`class_id`),
  KEY `session_id` (`session_id`),
  KEY `combination_id` (`combination_id`),
  CONSTRAINT `tz_alevel_exam_results_ibfk_1` FOREIGN KEY (`student_id`) REFERENCES `students` (`id`) ON DELETE CASCADE,
  CONSTRAINT `tz_alevel_exam_results_ibfk_2` FOREIGN KEY (`exam_id`) REFERENCES `tz_exams` (`id`) ON DELETE CASCADE,
  CONSTRAINT `tz_alevel_exam_results_ibfk_3` FOREIGN KEY (`class_id`) REFERENCES `classes` (`id`) ON DELETE CASCADE,
  CONSTRAINT `tz_alevel_exam_results_ibfk_4` FOREIGN KEY (`session_id`) REFERENCES `sessions` (`id`) ON DELETE CASCADE,
  CONSTRAINT `tz_alevel_exam_results_ibfk_5` FOREIGN KEY (`combination_id`) REFERENCES `tz_alevel_combinations` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;